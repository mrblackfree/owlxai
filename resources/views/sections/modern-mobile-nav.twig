{# Modern Mobile Navigation #}
<div class="flex items-center justify-between px-4 py-3">
	{# Logo & Menu Toggle #}
	<div class="flex items-center gap-3">
		<button type="button" 
				class="w-10 h-10 rounded-lg flex items-center justify-center hover:bg-white/10 transition-colors lg:hidden"
				@click="document.body.classList.toggle('mobile-menu-open')">
			<i class="ti ti-menu-2 text-xl"></i>
		</button>

		<a href="{{ view_namespace }}" class="flex items-center">
			<img src="{{ option.brand.logo_dark ?? '/assets/logo-light.svg' }}" 
				 alt="{{ option.site.name ?? 'Logo' }}" 
				 class="hidden dark:block h-7 object-contain">
			<img src="{{ option.brand.logo ?? '/assets/logo-dark.svg' }}" 
				 alt="{{ option.site.name ?? 'Logo' }}" 
				 class="block dark:hidden h-7 object-contain">
		</a>
	</div>

	{# Right Actions #}
	<div class="flex items-center gap-2">
		{# Theme Toggle #}
		{% if option.color_scheme.modes is not defined or option.color_scheme.modes|length > 1 %}
			<mode-switcher>
				<button type="button" 
						class="w-10 h-10 rounded-lg flex items-center justify-center hover:bg-white/10 transition-colors">
					<i class="ti ti-moon dark:hidden"></i>
					<i class="ti ti-sun hidden dark:block"></i>
				</button>
			</mode-switcher>
		{% endif %}

		{# User Menu #}
		<div class="relative" x-data="{ open: false }" @click.outside="open = false">
			<button type="button" 
					class="w-10 h-10 rounded-lg overflow-hidden border-2 border-white/20 hover:border-white/40 transition-colors"
					@click="open = !open">
				{% if user.avatar %}
					<img src="{{ user.avatar }}" alt="{{ user.first_name }}" class="w-full h-full object-cover">
				{% else %}
					<div class="w-full h-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white font-semibold">
						{{ user.first_name|slice(0, 1)|upper }}
					</div>
				{% endif %}
			</button>

			{# Dropdown Menu #}
			<div x-show="open" 
				 x-transition
				 class="absolute right-0 top-full mt-2 w-64 glass-morphism rounded-xl shadow-xl overflow-hidden">
				{# User Info #}
				<div class="p-4 border-b border-white/10">
					<div class="flex items-center gap-3">
						<div class="w-12 h-12 rounded-lg overflow-hidden shrink-0">
							{% if user.avatar %}
								<img src="{{ user.avatar }}" alt="{{ user.first_name }}" class="w-full h-full object-cover">
							{% else %}
								<div class="w-full h-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white font-semibold">
									{{ user.first_name|slice(0, 1)|upper }}
								</div>
							{% endif %}
						</div>
						<div class="overflow-hidden">
							<div class="font-semibold truncate">{{ user.first_name }} {{ user.last_name }}</div>
							<div class="text-sm text-content-dimmed truncate">{{ user.email }}</div>
						</div>
					</div>
				</div>

				{# Menu Items #}
				<div class="py-2">
					<a href="app/account" class="flex items-center gap-3 px-4 py-2.5 hover:bg-white/10 transition-colors">
						<i class="ti ti-user-circle"></i>
						<span>{{ __('My Account') }}</span>
					</a>
					
					{% if user.role == 'admin' %}
						<a href="admin" class="flex items-center gap-3 px-4 py-2.5 hover:bg-white/10 transition-colors">
							<i class="ti ti-settings"></i>
							<span>{{ __('Admin Panel') }}</span>
						</a>
					{% endif %}
					
					<div class="my-2 border-t border-white/10"></div>
					
					<a href="logout" class="flex items-center gap-3 px-4 py-2.5 hover:bg-white/10 transition-colors text-red-500">
						<i class="ti ti-logout"></i>
						<span>{{ __('Logout') }}</span>
					</a>
				</div>
			</div>
		</div>
	</div>
</div>

{# Mobile Slide Menu #}
<div class="fixed inset-0 z-40 lg:hidden" x-data="{ open: false }" @mobile-menu-open.window="open = true">
	{# Backdrop #}
	<div x-show="open" 
		 x-transition.opacity
		 class="fixed inset-0 bg-black/50 backdrop-blur-sm"
		 @click="open = false; document.body.classList.remove('mobile-menu-open')">
	</div>

	{# Menu Panel #}
	<div x-show="open" 
		 x-transition:enter="transition ease-out duration-300"
		 x-transition:enter-start="-translate-x-full"
		 x-transition:enter-end="translate-x-0"
		 x-transition:leave="transition ease-in duration-200"
		 x-transition:leave-start="translate-x-0"
		 x-transition:leave-end="-translate-x-full"
		 class="fixed inset-y-0 left-0 w-80 glass-morphism-dark backdrop-blur-xl overflow-y-auto"
		 @click.stop>
		
		{# Header #}
		<div class="p-4 border-b border-white/10">
			<div class="flex items-center justify-between">
				<h2 class="text-lg font-semibold">{{ __('Menu') }}</h2>
				<button type="button" 
						class="w-8 h-8 rounded-lg flex items-center justify-center hover:bg-white/10 transition-colors"
						@click="open = false; document.body.classList.remove('mobile-menu-open')">
					<i class="ti ti-x"></i>
				</button>
			</div>
		</div>

		{# Navigation Items #}
		<nav class="p-4 space-y-6">
			{% set active_menu = active_menu ?? null %}
			
			{% for key, section in nav.app|filter((section,key) => key not in [ 'secondary', 'account', 'workspace']) %}
				{% if section.items|length > 0 %}
					<div>
						{% if section.label %}
							<h4 class="px-3 mb-3 text-xs font-semibold text-content-dimmed uppercase tracking-wider">
								{{ p__('nav', section.label) }}
							</h4>
						{% endif %}

						<ul class="space-y-1">
							{% for item in section.items %}
								<li>
									<a href="{{ item.url }}" 
									   class="flex items-center gap-3 px-3 py-2.5 rounded-xl transition-all duration-200
											  {{ active_menu == item.url 
												 ? 'bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-white border border-white/20' 
												 : 'hover:bg-white/5' }}"
									   @click="open = false; document.body.classList.remove('mobile-menu-open')">
										
										<div class="w-10 h-10 rounded-xl flex items-center justify-center shrink-0
													{{ active_menu == item.url ? 'bg-gradient-to-br' : 'bg-white/5' }}"
											 style="--tw-gradient-from: {{ item.from ?? '#667eea' }}; --tw-gradient-to: {{ item.to ?? item.from ?? '#764ba2' }}">
											
											{% if item.iconType.value == 'ti' %}
												<i class="text-xl ti ti-{{ item.icon }} {{ active_menu == item.url ? 'text-white' : '' }}"></i>
											{% elseif item.iconType.value == 'svg' %}
												{{ item.icon|raw }}
											{% endif %}
										</div>

										<span class="font-medium">{{ p__('nav', item.label) }}</span>
									</a>
								</li>
							{% endfor %}
						</ul>
					</div>
				{% endif %}
			{% endfor %}
		</nav>
	</div>
</div>

{# Mobile Menu Toggle Script #}
<script>
document.addEventListener('DOMContentLoaded', () => {
	const body = document.body;
	
	// Listen for menu toggle
	body.addEventListener('click', (e) => {
		if (e.target.closest('[data-mobile-menu-toggle]')) {
			window.dispatchEvent(new CustomEvent('mobile-menu-open'));
		}
	});
	
	// Prevent body scroll when menu is open
	const observer = new MutationObserver((mutations) => {
		mutations.forEach((mutation) => {
			if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
				if (body.classList.contains('mobile-menu-open')) {
					body.style.overflow = 'hidden';
				} else {
					body.style.overflow = '';
				}
			}
		});
	});
	
	observer.observe(body, { attributes: true });
});
</script>
